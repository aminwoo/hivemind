# Training Data Analysis Script

## Overview

The `analyze_training_data.py` script reads and analyzes training data generated by the C++ selfplay engine. It displays board positions, move distributions, and game outcomes in a human-readable format.

## Features

- **Board Visualization**: Displays both Bughouse boards from team perspective
  - Uppercase letters = our team's pieces
  - Lowercase letters = opponent's pieces
  - Shows pocket pieces (captured pieces available for drops)
- **Move Policy Distribution**: Shows the top predicted moves for each board with probabilities

- **Game Outcomes**: Displays who won (team 0, team 1, or draw)

- **Board State**: Shows castling rights, en passant squares, and which boards are on turn

## Usage

### Basic Examples

```bash
# Analyze first 3 samples from one file
uv run python analyze_training_data.py --num-samples 3

# Analyze specific samples by index
uv run python analyze_training_data.py --sample-indices "0,100,500"

# Analyze from multiple files
uv run python analyze_training_data.py --num-samples 5 --num-files 3

# Show raw plane values (for debugging)
uv run python analyze_training_data.py --num-samples 2 --show-planes

# Use a different data directory
uv run python analyze_training_data.py --data-dir /path/to/data --num-samples 5
```

### Command Line Options

- `--data-dir`: Directory containing parquet files (default: `/home/ben/hivemind/engine/selfplay_games/training_data_parquet`)
- `--num-samples`: Number of samples to analyze per file (default: 5)
- `--num-files`: Number of parquet files to process (default: 1)
- `--show-planes`: Show raw plane values for debugging
- `--sample-indices`: Comma-separated list of specific sample indices (e.g., "0,5,10")

## Data Format

The training data uses 64 channels to represent the game state:

### Board A (Channels 0-31)

- **0-5**: Our pieces (P, N, B, R, Q, K)
- **6-11**: Opponent pieces (P, N, B, R, Q, K)
- **12-16**: Our pocket pieces (P, N, R, B, Q)
- **17-21**: Opponent pocket pieces (P, N, R, B, Q)
- **22**: Promoted pieces
- **23**: En passant square
- **24**: Color info
- **25**: Is our turn (1 = on turn)
- **26**: Constant plane (always 1)
- **27-30**: Castling rights (K, Q, k, q)
- **31**: Time advantage

### Board B (Channels 32-63)

Same structure as Board A

### Policies

- Each board has a policy distribution over 4672 possible actions (73 action types × 8 × 8 board)
- Actions include: moves, captures, drops, and pass

### Outcome

- `1.0`: Team 0 wins
- `-1.0`: Team 1 wins
- `0.0`: Draw

## Example Output

```
================================================================================
Sample #100
================================================================================

Board A (uppercase=our pieces, lowercase=opponent):
r . b q k b n r
p p p p . p p p
. . n . . . . .
. . . . p . . .
. . . . . . . .
. . . . P . . .
P P P P . P P P
R N B Q K B N R
  On turn: True
  Castling: KQkq
  EP square: -
  Our pocket: empty
  Opp pocket: empty

Board B (uppercase=our pieces, lowercase=opponent):
r n b q k b n r
p p p p p p p p
. . . . . . . .
. . . . . . . .
. . . . . . . .
. . . . . . . .
P P P P P P P P
R N B Q K B N R
  On turn: True
  Castling: KQkq
  EP square: -
  Our pocket: empty
  Opp pocket: empty

Outcome: -0.100
  (1.0 = team 0 wins, -1.0 = team 1 wins, 0.0 = draw)

Board A Policy Distribution:
  Move index 2291: 0.5736 (57.36%)
  Move index 4217: 0.3784 (37.84%)
  Move index 2227: 0.0479 (4.79%)

Board B Policy Distribution:
  Move index 460: 0.5977 (59.77%)
  Move index 459: 0.4023 (40.23%)
```

## Notes

- The script displays boards from the team's perspective (always looking from "our team's" viewpoint)
- Each parquet file (shard) contains ~16,000 training samples
- The policy indices correspond to specific move actions (see `src/domain/move2planes.py` for mapping)
- Pocket pieces show captured pieces that can be dropped back onto the board (Crazyhouse rules)
